# Frontend CI/CD ê°€ì´ë“œ

ì´ ë¬¸ì„œëŠ” í”„ë¡ íŠ¸ì—”ë“œ CI/CD íŒŒì´í”„ë¼ì¸ì˜ êµ¬ì¡°, ë²„ì „ ê´€ë¦¬ ì „ëµ, ë¡¤ë°± ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

## ëª©ì°¨

- [ê°œìš”](#ê°œìš”)
- [ì•„í‚¤í…ì²˜](#ì•„í‚¤í…ì²˜)
- [Docker ì´ë¯¸ì§€ íƒœê·¸ ì „ëµ](#docker-ì´ë¯¸ì§€-íƒœê·¸-ì „ëµ)
- [ì›Œí¬í”Œë¡œìš° ìƒì„¸](#ì›Œí¬í”Œë¡œìš°-ìƒì„¸)
- [S3 ë²„ì „ ê´€ë¦¬](#s3-ë²„ì „-ê´€ë¦¬)
- [ë¡¤ë°± ê°€ì´ë“œ](#ë¡¤ë°±-ê°€ì´ë“œ)
- [í•„ìˆ˜ Secrets ì„¤ì •](#í•„ìˆ˜-secrets-ì„¤ì •)

---

## ê°œìš”

í”„ë¡ íŠ¸ì—”ë“œëŠ” ë‘ ê°€ì§€ ë°©ì‹ìœ¼ë¡œ ë°°í¬ë©ë‹ˆë‹¤:

| ë°°í¬ ëŒ€ìƒ | ìš©ë„ | ë²„ì „ ê´€ë¦¬ |
|-----------|------|-----------|
| **S3 + CloudFront** | ì •ì  ì›¹ í˜¸ìŠ¤íŒ… (ì£¼ìš”) | ë²„ì „ë³„ í´ë” (`/v1.0.0/`) |
| **GHCR + Kubernetes** | ì»¨í…Œì´ë„ˆ ë°°í¬ | Docker ì´ë¯¸ì§€ íƒœê·¸ |

### í•µì‹¬ ì›ì¹™

1. **ì´ë¯¸ì§€ëŠ” Devì—ì„œë§Œ ë¹Œë“œ** - ProdëŠ” ê²€ì¦ëœ ì´ë¯¸ì§€ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©
2. **í™˜ê²½ ì°¨ì´ëŠ” ëŸ°íƒ€ì„ ì„¤ì •ìœ¼ë¡œ** - `config.js`ë¡œ í™˜ê²½ë³„ ì„¤ì • ì£¼ì…
3. **ë²„ì „ë³„ ë³´ê´€** - S3ì™€ GHCR ëª¨ë‘ ì´ì „ ë²„ì „ ì˜êµ¬ ë³´ê´€

---

## ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Development Flow                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   dev ë¸Œëœì¹˜ push                                                        â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚           frontend-dev.yaml                          â”‚               â”‚
â”‚   â”‚                                                      â”‚               â”‚
â”‚   â”‚   1. pnpm install & type-check                      â”‚               â”‚
â”‚   â”‚   2. pnpm build                                      â”‚               â”‚
â”‚   â”‚   3. Docker build & push to GHCR                    â”‚               â”‚
â”‚   â”‚      - :sha-abc1234                                 â”‚               â”‚
â”‚   â”‚      - :v1.0.0                                      â”‚               â”‚
â”‚   â”‚      - :latest-dev                                  â”‚               â”‚
â”‚   â”‚   4. S3 ë°°í¬ (dev ë²„í‚·)                              â”‚               â”‚
â”‚   â”‚      - /v1.0.0-abc1234/ (ë²„ì „ í´ë”)                 â”‚               â”‚
â”‚   â”‚      - / (ë£¨íŠ¸, í˜„ì¬ ì„œë¹™)                           â”‚               â”‚
â”‚   â”‚   5. CloudFront ìºì‹œ ë¬´íš¨í™”                          â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Production Flow                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   v* íƒœê·¸ push ë˜ëŠ” ìˆ˜ë™ íŠ¸ë¦¬ê±°                                           â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚           frontend-prod.yaml                         â”‚               â”‚
â”‚   â”‚                                                      â”‚               â”‚
â”‚   â”‚   1. GHCRì—ì„œ ì´ë¯¸ì§€ ì¡´ì¬ í™•ì¸                        â”‚               â”‚
â”‚   â”‚   2. ì´ë¯¸ì§€ì— :latest íƒœê·¸ ì¶”ê°€                       â”‚               â”‚
â”‚   â”‚   3. S3 ë°°í¬ (prod ë²„í‚·)                             â”‚               â”‚
â”‚   â”‚      - /v1.0.0/ (ë²„ì „ í´ë”)                          â”‚               â”‚
â”‚   â”‚      - / (ë£¨íŠ¸, í˜„ì¬ ì„œë¹™)                           â”‚               â”‚
â”‚   â”‚   4. CloudFront ìºì‹œ ë¬´íš¨í™”                          â”‚               â”‚
â”‚   â”‚   5. GitHub Release ìƒì„±                             â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Docker ì´ë¯¸ì§€ íƒœê·¸ ì „ëµ

### íƒœê·¸ ì¢…ë¥˜

| íƒœê·¸ | ì˜ˆì‹œ | ë™ì‘ | ìš©ë„ |
|------|------|------|------|
| **SHA íƒœê·¸** | `:sha-abc1234` | ê³ ì • (ë¶ˆë³€) | ì •í™•í•œ ì»¤ë°‹ ì¶”ì  |
| **ë²„ì „ íƒœê·¸** | `:v1.0.0` | ê³ ì • (ë¶ˆë³€) | ë¦´ë¦¬ìŠ¤ ë²„ì „ |
| **Dev ìµœì‹ ** | `:latest-dev` | ì´ë™ (ë§¤ ë°°í¬) | Dev í™˜ê²½ ìµœì‹  |
| **Prod ìµœì‹ ** | `:latest` | ì´ë™ (ë§¤ ë°°í¬) | Prod í™˜ê²½ ìµœì‹  |
| **ì•ˆì •í™” ë²„ì „** | `:stable` ğŸ† | ì´ë™ (ìˆ˜ë™) | ê²€ì¦ ì™„ë£Œëœ ì•ˆì • ë²„ì „ |

### Stable íƒœê·¸ ì‚¬ìš©ë²•

`:stable` íƒœê·¸ëŠ” **ì¶©ë¶„íˆ ê²€ì¦ëœ ì•ˆì •í™” ë²„ì „**ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

**Stableë¡œ ì§€ì •í•˜ëŠ” ë°©ë²•:**

1. **Prod ë°°í¬ ì‹œ ì˜µì…˜ìœ¼ë¡œ**
   - Actions â†’ Frontend CI/CD (Prod) â†’ Run workflow
   - `mark_as_stable` ì²´í¬ë°•ìŠ¤ ì„ íƒ

2. **ë‚˜ì¤‘ì— ë³„ë„ë¡œ ì§€ì •**
   - Actions â†’ Frontend Mark as Stable â†’ Run workflow
   - ë²„ì „ ì…ë ¥ (ì˜ˆ: `v1.0.0`)

**ê¶Œì¥ í”Œë¡œìš°:**
```
v1.0.0 ë°°í¬ â†’ 3-7ì¼ ëª¨ë‹ˆí„°ë§ â†’ ë¬¸ì œ ì—†ìœ¼ë©´ stableë¡œ ì§€ì •
```

**Stable ë²„ì „ ì‚¬ìš©:**
```bash
# K8sì—ì„œ stable ë²„ì „ ì‚¬ìš©
helm upgrade frontend ./helm/charts/frontend --set image.tag=stable

# S3ì—ì„œ stableë¡œ ë¡¤ë°±
aws s3 sync s3://${BUCKET}/stable/ s3://${BUCKET}/ --delete
```

### íƒœê·¸ ë™ì‘ ì˜ˆì‹œ

```
[1] dev ë¸Œëœì¹˜ push (ì»¤ë°‹ abc1234, ë²„ì „ 1.0.0)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ sha256:abc123...                    â”‚
    â”‚   â”œâ”€â”€ :sha-abc1234  (ì˜êµ¬)          â”‚
    â”‚   â”œâ”€â”€ :v1.0.0       (ì˜êµ¬)          â”‚
    â”‚   â””â”€â”€ :latest-dev   (í˜„ì¬ dev ìµœì‹ ) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[2] prod ë°°í¬ (v1.0.0ì„ í”„ë¡œë•ì…˜ìœ¼ë¡œ)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ sha256:abc123...                    â”‚
    â”‚   â”œâ”€â”€ :sha-abc1234                  â”‚
    â”‚   â”œâ”€â”€ :v1.0.0                       â”‚
    â”‚   â”œâ”€â”€ :latest-dev                   â”‚
    â”‚   â””â”€â”€ :latest  â† ì¶”ê°€ë¨!            â”‚  â† 4ê°œ íƒœê·¸ê°€ ê°™ì€ ì´ë¯¸ì§€
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[3] ìƒˆ dev ë°°í¬ (ì»¤ë°‹ def5678, ë²„ì „ 1.0.1)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ sha256:abc123... (ì´ì „)             â”‚
    â”‚   â”œâ”€â”€ :sha-abc1234                  â”‚
    â”‚   â”œâ”€â”€ :v1.0.0                       â”‚
    â”‚   â””â”€â”€ :latest      â† prodëŠ” ê·¸ëŒ€ë¡œ  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ sha256:def456... (ìƒˆ ì´ë¯¸ì§€)        â”‚
    â”‚   â”œâ”€â”€ :sha-def5678                  â”‚
    â”‚   â”œâ”€â”€ :v1.0.1                       â”‚
    â”‚   â””â”€â”€ :latest-dev  â† ì´ë™!          â”‚  â† devë§Œ ìƒˆ ì´ë¯¸ì§€
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•µì‹¬ í¬ì¸íŠ¸**: íƒœê·¸ëŠ” ì´ë¯¸ì§€ì˜ "ë³„ëª…"ì¼ ë¿, ì‹¤ì œ ì´ë¯¸ì§€ëŠ” SHA digestë¡œ ì‹ë³„ë©ë‹ˆë‹¤.

---

## ì›Œí¬í”Œë¡œìš° ìƒì„¸

### frontend-dev.yaml

**íŠ¸ë¦¬ê±°:**
- `dev` ë˜ëŠ” `dev-frontend` ë¸Œëœì¹˜ push
- `services/frontend/**` ê²½ë¡œ ë³€ê²½ ì‹œ

**ì‹¤í–‰ ë‹¨ê³„:**

```yaml
Jobs:
  1. build-and-test:
     - pnpm install
     - pnpm type-check
     - pnpm build (ê²€ì¦ìš©)
     - ë²„ì „ ì •ë³´ ì¶”ì¶œ

  2. docker-build-push:
     - Docker Buildx ì„¤ì •
     - GHCR ë¡œê·¸ì¸
     - ì´ë¯¸ì§€ ë¹Œë“œ & í‘¸ì‹œ
     - íƒœê·¸: :sha-xxx, :v1.0.0, :latest-dev

  3. deploy-s3-dev:
     - pnpm build (ë°°í¬ìš©)
     - config.js ì£¼ì… (dev ì„¤ì •)
     - S3 ë²„ì „ í´ë” ë°°í¬
     - S3 ë£¨íŠ¸ ë°°í¬
     - CloudFront ë¬´íš¨í™”
```

### frontend-prod.yaml

**íŠ¸ë¦¬ê±°:**
- `v*` íƒœê·¸ push (ì˜ˆ: `v1.0.0`)
- ìˆ˜ë™ íŠ¸ë¦¬ê±° (ì›Œí¬í”Œë¡œìš° ë””ìŠ¤íŒ¨ì¹˜)

**ì‹¤í–‰ ë‹¨ê³„:**

```yaml
Jobs:
  1. validate:
     - GHCRì—ì„œ ì´ë¯¸ì§€ ì¡´ì¬ í™•ì¸
     - ë²„ì „ ì •ë³´ ì¤€ë¹„

  2. tag-image-prod:
     - ê¸°ì¡´ ì´ë¯¸ì§€ pull
     - :latest íƒœê·¸ ì¶”ê°€
     - :v{version} íƒœê·¸ ì¶”ê°€
     - GHCRì— push

  3. deploy-s3-prod:
     - ì†ŒìŠ¤ ì²´í¬ì•„ì›ƒ (í•´ë‹¹ íƒœê·¸)
     - pnpm build
     - config.js ì£¼ì… (prod ì„¤ì •)
     - S3 ë²„ì „ í´ë” ë°°í¬
     - S3 ë£¨íŠ¸ ë°°í¬
     - CloudFront ë¬´íš¨í™”

  4. create-release:
     - GitHub Release ìƒì„±
     - ë¦´ë¦¬ìŠ¤ ë…¸íŠ¸ ìë™ ìƒì„±
```

---

## S3 ë²„ì „ ê´€ë¦¬

### í´ë” êµ¬ì¡°

```
s3://your-bucket-dev/
â”œâ”€â”€ v1.0.0-abc1234/        # ë²„ì „ + ì»¤ë°‹ (ì˜êµ¬ ë³´ê´€)
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ config.js
â”‚   â””â”€â”€ assets/
â”œâ”€â”€ v1.0.1-def5678/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ index.html              # í˜„ì¬ ì„œë¹™ ì¤‘ì¸ ë²„ì „
â”œâ”€â”€ config.js
â””â”€â”€ assets/

s3://your-bucket-prod/
â”œâ”€â”€ v1.0.0/                 # ë²„ì „ë³„ í´ë” (ì˜êµ¬ ë³´ê´€)
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ config.js
â”‚   â””â”€â”€ assets/
â”œâ”€â”€ v1.0.1/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ index.html              # í˜„ì¬ ì„œë¹™ ì¤‘ì¸ ë²„ì „
â”œâ”€â”€ config.js
â””â”€â”€ assets/
```

### ìºì‹œ ì „ëµ

| íŒŒì¼ | Cache-Control | ì´ìœ  |
|------|---------------|------|
| `index.html` | `no-cache` | í•­ìƒ ìµœì‹  ë²„ì „ ì²´í¬ |
| `config.js` | `no-cache` | ëŸ°íƒ€ì„ ì„¤ì •, ì¦‰ì‹œ ë°˜ì˜ |
| `assets/*` | `max-age=31536000, immutable` | í•´ì‹œëœ íŒŒì¼ëª…, ì˜êµ¬ ìºì‹œ |

---

## ë¡¤ë°± ê°€ì´ë“œ

### ğŸš€ GitHub Actions ë¡¤ë°± (ì¶”ì²œ!)

**ê°€ì¥ ì‰¬ìš´ ë°©ë²•!** ì›¹ì—ì„œ ë²„íŠ¼ í´ë¦­ë§Œìœ¼ë¡œ ë¡¤ë°±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

1. GitHub Repository â†’ **Actions** íƒ­
2. ì™¼ìª½ ë©”ë‰´ì—ì„œ **Frontend Rollback** ì„ íƒ
3. **Run workflow** ë²„íŠ¼ í´ë¦­
4. ì˜µì…˜ ì…ë ¥:
   - **environment**: `dev` ë˜ëŠ” `prod`
   - **version**: ë¡¤ë°±í•  ë²„ì „ (ì˜ˆ: `v1.0.0`, `v1.0.0-abc1234`)
   - **rollback_type**: `s3`, `k8s`, `both` ì¤‘ ì„ íƒ
   - **dry_run**: ì‹¤ì œ ë¡¤ë°± ì—†ì´ í™•ì¸ë§Œ í•˜ë ¤ë©´ ì²´í¬
5. **Run workflow** í´ë¦­!

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend Rollback                    [Run workflow â–¼]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  environment:     [dev     â–¼]                           â”‚
â”‚  version:         [v1.0.0        ]                      â”‚
â”‚  rollback_type:   [s3      â–¼]                           â”‚
â”‚  dry_run:         [ ] Check to preview only             â”‚
â”‚                                                         â”‚
â”‚                              [Cancel] [Run workflow]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### S3 ë¡¤ë°± (CLI, ~1ë¶„)

```bash
# í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
export BUCKET="your-s3-bucket"
export DIST_ID="your-cloudfront-distribution-id"
export ROLLBACK_VERSION="v1.0.0"  # ë¡¤ë°±í•  ë²„ì „

# 1. ì´ì „ ë²„ì „ì„ ë£¨íŠ¸ë¡œ ë³µì‚¬
aws s3 sync "s3://${BUCKET}/${ROLLBACK_VERSION}/" "s3://${BUCKET}/" --delete

# 2. CloudFront ìºì‹œ ë¬´íš¨í™”
aws cloudfront create-invalidation \
  --distribution-id "${DIST_ID}" \
  --paths "/*"

# 3. ë¬´íš¨í™” ìƒíƒœ í™•ì¸
aws cloudfront get-invalidation \
  --distribution-id "${DIST_ID}" \
  --id <invalidation-id>
```

### Kubernetes ë¡¤ë°± (Helm)

```bash
# ì´ì „ ë²„ì „ ì´ë¯¸ì§€ë¡œ ë¡¤ë°±
helm upgrade frontend ./helm/charts/frontend \
  --set image.tag=v1.0.0 \
  -f ./helm/environments/prod.yaml

# ë˜ëŠ” kubectlë¡œ ì§ì ‘ ë¡¤ë°±
kubectl rollout undo deployment/frontend -n wealist-prod

# ë¡¤ë°± ìƒíƒœ í™•ì¸
kubectl rollout status deployment/frontend -n wealist-prod
```

### Docker ì´ë¯¸ì§€ë¡œ ë¡¤ë°± (ìˆ˜ë™)

```bash
# 1. ì´ì „ ë²„ì „ ì´ë¯¸ì§€ pull
docker pull ghcr.io/your-org/frontend:v1.0.0

# 2. latest íƒœê·¸ë¡œ ì¬ì§€ì •
docker tag ghcr.io/your-org/frontend:v1.0.0 ghcr.io/your-org/frontend:latest
docker push ghcr.io/your-org/frontend:latest

# 3. K8s ì¬ë°°í¬ (ì´ë¯¸ì§€ pull)
kubectl rollout restart deployment/frontend -n wealist-prod
```

---

## í•„ìˆ˜ Secrets ì„¤ì •

GitHub Repository Settings > Secrets and variables > Actionsì—ì„œ ì„¤ì •:

### Dev í™˜ê²½

| Secret | ì„¤ëª… | ì˜ˆì‹œ |
|--------|------|------|
| `AWS_ROLE_ARN` | AWS OIDC ì—­í•  ARN | `arn:aws:iam::123456789:role/github-actions-frontend` |
| `AWS_S3_BUCKET_DEV` | Dev S3 ë²„í‚·ëª… | `wealist-frontend-dev` |
| `AWS_CLOUDFRONT_DISTRIBUTION_ID_DEV` | Dev CloudFront ID | `E1234567890ABC` |
| `API_DOMAIN_DEV` | Dev API ë„ë©”ì¸ (ì„ íƒ) | `api.dev.wealist.co.kr` |

### Prod í™˜ê²½

| Secret | ì„¤ëª… | ì˜ˆì‹œ |
|--------|------|------|
| `AWS_S3_BUCKET_PROD` | Prod S3 ë²„í‚·ëª… | `wealist-frontend-prod` |
| `AWS_CLOUDFRONT_DISTRIBUTION_ID_PROD` | Prod CloudFront ID | `E0987654321XYZ` |
| `API_DOMAIN_PROD` | Prod API ë„ë©”ì¸ (ì„ íƒ) | `api.wealist.co.kr` |

### ê³µí†µ (ì„ íƒ)

| Secret | ì„¤ëª… | ì˜ˆì‹œ |
|--------|------|------|
| `VITE_API_BASE_URL` | ë¹Œë“œ íƒ€ì„ API URL | `` (ë¹ˆ ë¬¸ìì—´ ê¶Œì¥) |

---

## ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Dev ë°°í¬

- [ ] `dev` ë˜ëŠ” `dev-frontend` ë¸Œëœì¹˜ì— ì½”ë“œ push
- [ ] GitHub Actions ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ í™•ì¸
- [ ] GHCRì— ì´ë¯¸ì§€ í‘¸ì‹œ í™•ì¸
- [ ] S3 ë°°í¬ í™•ì¸
- [ ] CloudFront ìºì‹œ ë¬´íš¨í™” ì™„ë£Œ í™•ì¸
- [ ] ì‹¤ì œ ì‚¬ì´íŠ¸ì—ì„œ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

### Prod ë°°í¬

- [ ] Devì—ì„œ ì¶©ë¶„íˆ í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [ ] Git íƒœê·¸ ìƒì„± (`git tag v1.0.0 && git push origin v1.0.0`)
- [ ] GitHub Actions ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ í™•ì¸
- [ ] GHCR ì´ë¯¸ì§€ `:latest` íƒœê·¸ í™•ì¸
- [ ] S3 prod ë°°í¬ í™•ì¸
- [ ] GitHub Release ìƒì„± í™•ì¸
- [ ] í”„ë¡œë•ì…˜ ì‚¬ì´íŠ¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ì´ë¯¸ì§€ê°€ GHCRì—ì„œ ì•ˆ ë³´ì—¬ìš”

```bash
# GHCR ë¡œê·¸ì¸ í™•ì¸
echo $GITHUB_TOKEN | docker login ghcr.io -u USERNAME --password-stdin

# ì´ë¯¸ì§€ ëª©ë¡ í™•ì¸
docker search ghcr.io/your-org/frontend
```

### CloudFront ìºì‹œê°€ ì•ˆ í’€ë ¤ìš”

```bash
# ë¬´íš¨í™” ìƒíƒœ í™•ì¸
aws cloudfront list-invalidations --distribution-id $DIST_ID

# ê°•ì œ ì „ì²´ ë¬´íš¨í™”
aws cloudfront create-invalidation \
  --distribution-id $DIST_ID \
  --paths "/*"
```

### S3 ê¶Œí•œ ì˜¤ë¥˜

AWS OIDC ì—­í• ì— ë‹¤ìŒ ê¶Œí•œì´ ìˆëŠ”ì§€ í™•ì¸:
- `s3:PutObject`
- `s3:GetObject`
- `s3:DeleteObject`
- `s3:ListBucket`
- `cloudfront:CreateInvalidation`

---

## ê´€ë ¨ ë¬¸ì„œ

- [Helm Chart ê°€ì´ë“œ](./helm-guide.md)
- [Kubernetes ë°°í¬ ê°€ì´ë“œ](./k8s-deployment.md)
- [ëª¨ë‹ˆí„°ë§ ì„¤ì •](./monitoring.md)
